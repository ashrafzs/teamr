 
{{#if field.data != null }}
<table class="table" ref:table>
	 <thead><th colspan="32" class="tableHeader">{{field.data.items[0].month }} {{field.data.items[0].year }}</th></thead>
		<thead>
			<tr>
			<th> </th>
			{{#if days != null && days.length > 1}}
			
			{{#each days as day}}
				<th style="font-size: 11px;">{{day.day}}</th>
			{{/each}}
			{{/if}}
			</tr>
			<tr>
				<th> </th>
			 {{#if days != null && days.length > 1}} 
			 {{#each days as day}}
				<th style="font-size: 9px;">{{GetDayName(new Date(field.data.items[0].year,GetMonth(field.data.items[0].month),day.day).getDay())}}</th>
			{{/each}}
			{{/if}}
			</tr>
		</thead>

		<tbody style="font-size: 8px;">
			 {{#if users != null && users.length > 0}}
			 {{#each users as user}}
			<tr>
				<td>{{user.name}}</td>
				 {{#if days != null && days.length > 0}} 
				 {{#each days as day}}
				 {{#if user.schedules != null && user.schedules.length > 0}}
				 {{#if GetUserSchedule(day.schedules, user).length > 1}}
					<td style ="background-image: linear-gradient(225deg, red, red 8px, transparent 2px, transparent);" 
					data-tooltip="{{GetUserEvents(day.schedules, user)}}"> 
						 {{GetUserSchedule(day.schedules, user)[0].tag}}
					</td>
					 {{else}}
					 {{#if GetUserSchedule(day.schedules, user) != ''}}
					<td data-tooltip="{{GetUserEvents(day.schedules, user)}}">
						 {{GetUserSchedule(day.schedules, user)[0].tag}}
					</td>
					  {{else}} 
					 <td>{{GetUserSchedule(day.schedules, user)}}</td>
					  {{/if}}
					 {{/if}}
				 {{else}}
				<td> </td>
				{{/if}}
				{{/each}}
				{{/if}}
			</tr>
			 {{/each}}
			 {{/if}}
		</tbody>
	</table>
{{/if}}
<script>    
	export default {
		oncreate() {
			var data = this.get("field").data;
			this.set({ color: "red "});

			if (data == null) {
				return;
			}
			var users = data.items;
			var app = this.get("app");
			var metadata = this.get("field").metadata;
			
			var days =[];
			for(var day =1 ; day<= 31; day++){
				var schedules = [];
				for (var user of users) {
					var task = this.Check(day, user.schedules);
					schedules.push({ user : user, task : task});
				}
				days.push({
					day : day,
					schedules: schedules
				});
			}
			
			this.set({
				days : days
			})
		},
		 methods: {
			Check : function(number, list) {
				 var tasks = [];
				 for (let i = 0; i < list.length; i++) {
					 if (list[i].day == number) {
						 tasks.push(list[i]);
					 }
				 };
				 if (tasks.length)
					 return tasks;
				 else
					 return '';
			 },
			
		 },
		computed: {
				users: (field) => {
					if(field.data != null){
						return field.data.items;
					}
					
				}
		},
		helpers: {
				GetUserSchedule(schedules, user){
					var schedule= schedules.filter(a => a.user == user)[0];
					if(schedule != null)
					return schedule.task;
				},
				GetUserEvents(schedules, user) {
					var events=[];
						var schedule = schedules.filter(a => a.user == user)[0];
						if (schedule != null){
							for (var task of schedule.task) {
								events.push(task.event);
							}
							return events;
						}		
					},
				GetMonth(mon) {
					return new Date(Date.parse(mon + " 1, 2012")).getMonth();
				},
				GetDayName(day)
				{
					var days=["Su","Mo","Tu","We","Th","Fr","Sa"];
					return days[day];
				}
			},
        components: {}
	};
</script>

<style>
	.table{
		margin-bottom: 40px;
		font-size: 12px;
	}
	th, td {
		font-size: 13px; 
	}
	.tableHeader {
		text-align: center;
		font-weight: bold;
	}

</style>